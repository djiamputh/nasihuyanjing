<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ralzz Api is a simple and lightweight REST API built with Express.js">
    <meta name="theme-color" content="#1a1a1a">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ralzz-api.vercel.app">
    <meta property="og:title" content="Ralzz API">
    <title>Ralzz API - Docs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { 'mono': ['Ubuntu Mono', 'monospace'], 'sans': ['DM Sans', 'system-ui', 'sans-serif'] } } } }
    </script>
    <style>
        ::-webkit-scrollbar { display: none !important; }
        body { position: relative; background-color: #181818; letter-spacing: -0.4px; }
        body::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; min-height: 100vh; z-index: -1;
            background-image: linear-gradient(rgba(255,255,255,0.04) 1.5px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.04) 1.5px, transparent 1.5px);
            background-size: 40px 40px; pointer-events: none;
        }
        .category-scroll-container { display: flex; overflow-x: auto; gap: 10px; }
        .status-badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 4px; font-weight: 600; }
        .status-ready { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid rgba(16,185,129,0.3); }
        .status-update { background: rgba(245,158,11,0.2); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3); }
        .status-error { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); }
        .content-type-badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; background: rgba(59,130,246,0.2); color: #3b82f6; border: 1px solid rgba(59,130,246,0.3); }
        .response-media-container { min-height: 200px; display: flex; align-items: center; justify-content: center; width: 100%; border-radius: 8px; overflow: hidden; }
        .response-media-container img, .response-media-container video { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 6px; }
        .response-media-container audio { width: 100%; max-width: 400px; }
        .code-block { font-family: 'Ubuntu Mono', monospace; background: rgba(15,23,42,0.8); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); overflow-x: auto; }
        .slide-up { animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .slide-down { animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .toast {
            position: fixed; bottom: 30px; right: 30px; background: rgba(15,23,42,0.95); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px 20px; font-size: 0.9rem;
            display: flex; align-items: center; gap: 10px; z-index: 1000; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            max-width: 350px; transform: translateY(100px); opacity: 0; transition: all 0.5s cubic-bezier(0.68,-0.55,0.27,1.55);
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .loader {
    width: 42px;
    height: 42px;
    border: 3px solid #2E2E2E;
    border-top-color: #e5e7eb;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
        @keyframes rotate { 100% { transform: rotate(360deg); } }
        @keyframes prixClipFix {
            0% { clip-path: polygon(50% 50%,0 0,0 0,0 0,0 0,0 0); }
            25% { clip-path: polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0); }
            50% { clip-path: polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%); }
            75% { clip-path: polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%); }
            100% { clip-path: polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0); }
        }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
        .stat-card { min-width: 160px; }
        @media (max-width: 768px) { .stat-card { min-width: 140px; } }
        
        /* Fix untuk input file agar padding sama dengan input text */
        input[type="file"] {
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            line-height: 1.25 !important;
        }

        input[type="file"]::file-selector-button {
            margin-right: 8px;
            padding: 6px 12px;
            background: #2a2a2a;
            color: white;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        input[type="file"]::file-selector-button:hover {
            background: #3a3a3a;
        }

        /* Tab Styles */
        .tab-container { display: flex; border-bottom: 1px solid #2E2E2E; margin-bottom: 16px; }
        .tab { padding: 8px 16px; background: transparent; border: none; color: #94a3b8; font-size: 0.875rem; font-weight: 500; cursor: pointer; position: relative; transition: all 0.2s; }
        .tab:hover { color: #e2e8f0; }
        .tab.active { color: #3b82f6; }
        .tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: #3b82f6; border-radius: 2px 2px 0 0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        
        /* Code Block Styles */
        .code-container { position: relative; margin-top: 12px; }
        .code-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: rgba(15,23,42,0.9); border: 1px solid rgba(255,255,255,0.05); border-bottom: none; border-radius: 6px 6px 0 0; }
        .code-header span { font-size: 0.75rem; color: #94a3b8; font-family: 'Ubuntu Mono', monospace; font-weight: 500; }
        .code-header button { padding: 4px 10px; background: rgba(59,130,246,0.2); color: #3b82f6; border: 1px solid rgba(59,130,246,0.3); border-radius: 4px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .code-header button:hover { background: rgba(59,130,246,0.3); }
        .code-content { background: rgba(15,23,42,0.8); border: 1px solid rgba(255,255,255,0.05); border-top: none; border-radius: 0 0 6px 6px; padding: 16px; overflow-x: auto; }
        .code-content pre { margin: 0; font-family: 'Ubuntu Mono', monospace; font-size: 0.875rem; line-height: 1.5; color: #e2e8f0; }
        .code-content code { font-family: 'Ubuntu Mono', monospace; }
    </style>
</head>
<body class="bg-[#181818] text-gray-200 antialiased font-sans min-h-screen">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-[#181818] flex flex-col items-center justify-center z-50">
        <div class="text-center mb-8">
            <div class="loader mx-auto mb-6"></div>
            <p class="text-slate-400">Loading documentation...</p>
        </div>
    </div>
    
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-4 slide-up">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-3">
                        
                        <div class="flex items-center gap-1">
                            <h1 id="titleApi" class="text-3xl md:text-4xl font-semibold text-white">Ralzz API</h1> 
                            <span class="px-1 mb-1 bg-slate-800 text-slate-300 text-xs font-semibold rounded-full">v1.0.0-x</span>
                        </div>
                    </div>
                    <p id="descApi" class="text-slate-300 max-w-3xl font-medium text-sm">
                        A comprehensive REST API built with Express.js, providing easy access to various web functionalities including downloaders, AI tools, image creators, and more.
                    </p>
                </div>
                
                <!-- Stats Cards -->
                <div class="w-full md:w-auto">
                    <div class="stats-grid">
                        <div class="stat-card bg-[#212121] border border-[#2E2E2E] rounded-xl p-2">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                    <i class="fas fa-code text-blue-400"></i>
                                </div>
                                <div>
                                    <div id="totalEndpoints" class="text-xl font-semibold text-white counter">0</div>
                                    <div class="text-slate-400 font-medium text-xs">Endpoints</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-[#212121] border border-[#2E2E2E] rounded-xl p-2">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                    <i class="fas fa-layer-group text-purple-400"></i>
                                </div>
                                <div>
                                    <div id="totalCategories" class="text-xl font-semibold text-white counter">0</div>
                                    <div class="text-slate-400 font-medium text-xs">Categories</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-[#212121] border border-[#2E2E2E] rounded-xl p-2">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                                    <i class="fas fa-check-circle text-emerald-400"></i>
                                </div>
                                <div>
                                    <div id="statusReady" class="text-xl font-semibold text-white">100%</div>
                                    <div class="text-slate-400 font-medium text-xs">Status Ready</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-[#212121] border border-[#2E2E2E] rounded-xl p-2">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                    <i class="fas fa-clock text-cyan-400"></i>
                                </div>
                                <div>
                                    <div id="serverTime" class="text-xl font-semibold text-white">00:00:00</div>
                                    <div class="text-slate-400 font-medium text-xs">Server Time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Horizontal Category Filter -->
            <div class="mb-6">
                
                <div class="category-scroll-container" id="categoryScroll">
                    <!-- Category filters will be dynamically added here -->
                </div>
            </div>
            
            <!-- Terminal Search Bar -->
            <div class="w-full border border-[#2E2E2E] overflow-hidden rounded-lg">
                <div class="border-b border-[#2E2E2E] bg-[#1a1a1a]">
                    <div class="flex items-center px-5 py-3 relative">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        </div>
                        <span class="text-xs text-gray-400 font-medium absolute left-1/2 -translate-x-1/2">terminal — bash — 120x40</span>
                    </div>
                </div>
                <div class="px-8 py-2 bg-[#212121]">
                    <div class="flex items-center gap-2 font-mono text-gray-400 text-sm font-semibold">
                        <span>
                            <span id="anuApi" class="text-green-500">ralzz@api</span>:<span class="text-blue-500">~</span>$ 
                        </span>
                        <div class="flex-1 relative">
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="search endpoints..." 
                                class="w-full font-mono text-sm py-1 bg-transparent text-white placeholder-gray-600 focus:outline-none border-none"
                                autocomplete="off"
                            >
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- API Content -->
        <section class="mb-16">
            <div id="content">
                <div id="noResults" class="text-center py-20 hidden">
                    <div class="max-w-md mx-auto">
                        <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-search text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3">No results found</h3>
                        <p class="text-slate-400 font-medium mb-6">Try different keywords or check the spelling. You can also browse by category using the filters above.</p>
                        <button id="clearSearchBtn" class="px-5 py-2.5 bg-[#212121] border border-[#2E2E2E] rounded-lg text-white font-medium hover:bg-[#262626] transition-colors">
                            Clear search
                        </button>
                    </div>
                </div>

                <div id="apiList" class="space-y-4">
                    <!-- API list will be loaded here dynamically -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="pt-10">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <p id="wm" class="text-gray-400 font-medium text-sm">© 2026 Ralzz API. All rights reserved.</p>
                </div>
                <div class="flex flex-col items-center md:items-end gap-4">
                    <div class="flex gap-5">
                        <a id="whatsappLink" target="_blank" class="group flex flex-col items-center">
                            <div class="w-10 h-10 rounded-full bg-green-500 border border-green-500 flex items-center justify-center mb-2 group-hover:bg-green-900/30 transition-colors">
                                <i class="fab fa-telegram text-xl"></i>
                            </div>
                            <span class="text-xs font-medium text-gray-400">Contact</span>
                        </a>
                        <a id="youtubeLink" target="_blank" class="group flex flex-col items-center">
                            <div class="w-10 h-10 rounded-full bg-red-500 border border-red-500 flex items-center justify-center mb-2 group-hover:bg-red-900/30 transition-colors">
                                <i class="fab fa-youtube text-xl"></i>
                            </div>
                            <span class="text-xs font-medium text-gray-400">YouTube</span>
                        </a>
                        <a id="githubLink" target="_blank" class="group flex flex-col items-center">
                            <div class="w-10 h-10 rounded-full bg-slate-800 border border-slate-800 flex items-center justify-center mb-2 group-hover:bg-slate-700 transition-colors">
                                <i class="fab fa-code text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-medium text-gray-400">Channel</span>
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </main>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

<script>
    let settings = {};
    let allApiItems = [];
    let originalCategories = [];
    let activeCategoryFilter = 'all';
    
    const categoryIcons = {
        'Downloader': 'fas fa-download', 'Imagecreator': 'fas fa-image', 'Openai': 'fas fa-robot', 'Random': 'fas fa-random',
        'Search': 'fas fa-search', 'Stalker': 'fas fa-user-secret', 'Tools': 'fas fa-tools', 'Orderkuota': 'fas fa-sim-card',
        'AI Tools': 'fas fa-brain', 'Entertainment': 'fas fa-gamepad', 'Utilities': 'fas fa-cogs', 'Social Media': 'fas fa-share-alt',
        'Canvas': 'fas fa-paint-brush'
    };
    
    const categoryColors = {
        'Downloader': 'bg-blue-500/20 text-blue-400', 'Imagecreator': 'bg-purple-500/20 text-purple-400',
        'Openai': 'bg-emerald-500/20 text-emerald-400', 'Random': 'bg-amber-500/20 text-amber-400',
        'Search': 'bg-cyan-500/20 text-cyan-400', 'Stalker': 'bg-red-500/20 text-red-400',
        'Tools': 'bg-slate-500/20 text-slate-400', 'Orderkuota': 'bg-green-500/20 text-green-400',
        'AI Tools': 'bg-indigo-500/20 text-indigo-400', 'Entertainment': 'bg-pink-500/20 text-pink-400',
        'Utilities': 'bg-orange-500/20 text-orange-400', 'Social Media': 'bg-teal-500/20 text-teal-400',
        'Canvas': 'bg-blue-500/20 text-blue-400'
    };

    document.addEventListener('DOMContentLoaded', function() { initializeApp(); });

    async function initializeApp() {
        try {
            settings = await loadSettings();
            setupUI();
            await loadAPIData();
            setupEventListeners();
            
            updateServerTime();
            setInterval(updateServerTime, 1000);
            
            setTimeout(() => {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }
                }, 1200);
            
        } catch (error) {
            console.error('Initialization error:', error);
            showErrorMessage(error);
        }
    }

    async function loadSettings() {
        try {
            const baseUrl = window.location.origin + "/settings";
            const response = await fetch(baseUrl);
            if (!response.ok) throw new Error('Settings not found');
            const data = await response.json();
            return data;
        } catch (error) {
            return getDefaultSettings();
        }
    }

    async function loadAPIData() {
        try {
            if (!settings.categories || settings.categories.length === 0) {
                const apiDataUrl = window.location.origin + "/api/data";
                try {
                    const response = await fetch(apiDataUrl);
                    if (response.ok) {
                        const apiData = await response.json();
                        settings.categories = apiData.categories || [];
                    }
                } catch (apiError) {}
            }
            
            if (!settings.categories || settings.categories.length === 0) {
                settings.categories = getDemoCategories();
            }
            
            originalCategories = JSON.parse(JSON.stringify(settings.categories || []));
            
            allApiItems = [];
            originalCategories.forEach(category => {
                if (category && category.items) {
                    category.items.forEach(item => {
                        if (item) {
                            allApiItems.push({ ...item, category: category.name });
                        }
                    });
                }
            });
            
            renderAPIData(originalCategories);
            initializeCategoryFilters();
            updateStats();
            
        } catch (error) {
            renderAPIData([]);
        }
    }

    function getDemoCategories() {
        return [
            {
                name: "Downloader",
                items: [
                    { name: "YouTube Downloader", method: "GET", path: "/api/download/youtube?url=", desc: "Download videos from YouTube in various formats and qualities" },
                    { name: "Instagram Downloader", method: "GET", path: "/api/download/instagram?url=", desc: "Download photos and videos from Instagram" }
                ]
            },
            {
                name: "AI Tools",
                items: [
                    { name: "ChatGPT", method: "GET", path: "/api/ai/chatgpt?prompt=", desc: "AI-powered chatbot using OpenAI's GPT technology" },
                    { name: "Image Upscaler", method: "POST", path: "/tools/upscale", body: { apikey: "string", image: "buffer" }, desc: "Upscale images using AI" }
                ]
            },
            {
                name: "Search",
                items: [
                    { name: "Google Search", method: "GET", path: "/api/search/google?query=", desc: "Search the web using Google" },
                    { name: "Image Search", method: "GET", path: "/api/search/images?query=", desc: "Search for images across the web" }
                ]
            },
            {
                name: "Canvas",
                items: [
                    { name: "Image Editor", method: "POST", path: "/api/canvas/edit", body: { image: "buffer", operation: "text" }, desc: "Basic image editing tools with file upload" },
                    { name: "Text Overlay", method: "GET", path: "/api/canvas/text?image=&text=", desc: "Add text overlay to images" }
                ]
            }
        ];
    }

    function getDefaultSettings() {
        return {
            name: "Ralzz API",
            creator: "Ralzz Team",
            description: "Interactive API documentation with real-time testing",
            categories: [],
            theme: "dark",
            linkWhatsapp: "https://t.me/ralzzfck",
            linkYoutube: "https://youtube.com/@ralzzofc",
            linkGithub: "https://t.me/rlzznew"
        };
    }

    function setupUI() {
        const titleApi = document.querySelectorAll("#titleApi");
        if (titleApi) titleApi.forEach(el => { el.textContent = settings.name });
        
        const descApi = document.querySelectorAll("#descApi");
        if (descApi) descApi.forEach(el => { el.textContent = settings.description });
        
        const wmApi = document.querySelectorAll("#wm");
        if (wmApi) wmApi.forEach(el => { el.textContent = `© 2023 ${settings.creator}. All rights reserved.` });
        
        const anuApi = document.querySelectorAll("#anuApi");
        if (anuApi) anuApi.forEach(el => { el.textContent = `root@${settings.creator}` });
        
        const whatsappLink = document.getElementById('whatsappLink');
        const youtubeLink = document.getElementById('youtubeLink');
        const githubLink = document.getElementById('githubLink');
        if (whatsappLink) whatsappLink.href = settings.linkWhatsapp || '#';
        if (youtubeLink) youtubeLink.href = settings.linkYoutube || '#';
        if (githubLink) githubLink.href = settings.linkGithub || '#';
    }

    function updateServerTime() {
        const serverTimeElement = document.getElementById('serverTime');
        if (!serverTimeElement) return;
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
        serverTimeElement.textContent = timeString;
    }

    function initializeCategoryFilters() {
        const categoryScroll = document.getElementById('categoryScroll');
        if (!categoryScroll) return;
        
        categoryScroll.innerHTML = `
            <button class="category-filter active shrink-0 px-2 py-2 rounded-xl bg-gradient-to-r text-sm from-blue-500 to-purple-500 text-white font-medium transition-all duration-300 flex items-center gap-2" data-category="all">
                <i class="fas fa-layer-group"></i>
                <span>All Endpoints</span>
            </button>
        `;
        
        originalCategories.forEach(category => {
            if (!category || !category.name) return;
            const colorClass = categoryColors[category.name] || 'bg-slate-700/30 text-slate-300';
            const icon = categoryIcons[category.name] || 'fas fa-folder';
            
            categoryScroll.innerHTML += `
                <button class="category-filter shrink-0 px-2 py-2 rounded-xl bg-[#212121] border border-[#2E2E2E] text-white font-medium transition-all duration-300 flex items-center gap-2 text-sm hover:bg-[#262626]" data-category="${category.name.toLowerCase()}">
                    <i class="${icon}"></i>
                    <span>${category.name}</span>
                    <span class="text-xs bg-slate-800/50 px-2 py-1 rounded-full">${category.items?.length || 0}</span>
                </button>
            `;
        });
        
        document.querySelectorAll('.category-filter').forEach(filter => {
            filter.addEventListener('click', function() {
                const category = this.dataset.category;
                document.querySelectorAll('.category-filter').forEach(f => {
                    f.classList.remove('active', 'bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
                    f.classList.add('bg-[#212121]', 'border', 'border-[#2E2E2E]');
                });
                this.classList.add('active', 'bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
                this.classList.remove('bg-[#212121]', 'border', 'border-[#2E2E2E]');
                activeCategoryFilter = category;
                applyCategoryFilter(category);
            });
        });
    }

    function applyCategoryFilter(category) {
        if (category === 'all') {
            renderAPIData(originalCategories);
        } else {
            const filteredCategories = originalCategories.filter(cat => cat.name.toLowerCase() === category.toLowerCase());
            renderAPIData(filteredCategories);
        }
        updateSearchResultsCount();
    }

    function updateStats() {
        const totalEndpoints = document.getElementById('totalEndpoints');
        const totalCategories = document.getElementById('totalCategories');
        const statusReady = document.getElementById('statusReady');
        if (!totalEndpoints || !totalCategories || !statusReady) return;
        
        let endpointCount = 0;
        let categoryCount = originalCategories.length;
        originalCategories.forEach(category => { endpointCount += (category.items || []).length; });
        
        animateCounter(totalEndpoints, endpointCount);
        animateCounter(totalCategories, categoryCount);
        statusReady.textContent = '100%';
    }

    function animateCounter(element, target) {
        let current = 0;
        const increment = target / 30;
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            element.textContent = Math.floor(current);
        }, 50);
    }

    function renderAPIData(categories) {
        const apiList = document.getElementById('apiList');
        if (!apiList) return;
        apiList.innerHTML = '';
        
        if (!categories || categories.length === 0) {
            apiList.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-code text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">No API endpoints available</h3>
                    <p class="text-slate-400 font-medium">Check back later or contact the administrator.</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        categories.forEach((category, catIndex) => {
            if (!category || !category.items || category.items.length === 0) return;
            
            category.items.forEach((item, endpointIndex) => {
                if (!item) return;
                
                const method = item.method || "GET";
                const pathParts = (item.path || '').split('?');
                const path = pathParts[0] || '';
                const itemName = item.name || 'Unnamed Endpoint';
                const itemDesc = item.desc || 'No description available';
                const bodyParams = item.body || {};
                
                let initialUrl = window.location.origin + (item.path || '');
                if (method === 'GET' && item.path && item.path.includes('?')) {
                    const [base, query] = item.path.split('?');
                    if (query) {
                        const params = new URLSearchParams(query);
                        for (const [key] of params) { params.set(key, ''); }
                        initialUrl = window.location.origin + base + '?' + params.toString();
                    }
                }
                
                const formId = `form-${catIndex}-${endpointIndex}`;
                const methodBadgeClass = method === 'POST' ? 'bg-green-500 border border-green-500' : 'bg-blue-500 border border-blue-500';
                
                html += `
                <div class="api-item bg-[#212121] border border-[#2E2E2E] rounded-lg overflow-hidden fade-in" 
                     data-method="${method.toLowerCase()}"
                     data-path="${path}"
                     data-alias="${itemName}"
                     data-description="${itemDesc}"
                     data-category="${(category.name || '').toLowerCase()}">
                    
                    <button onclick="toggleEndpoint(${catIndex}, ${endpointIndex})" class="w-full text-left">
                        <div class="px-6 py-3 bg-[#212121]">
                            <div class="flex items-start gap-4">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between gap-3">
                                        <h3 class="flex items-center gap-3 font-medium text-md text-white" title="${itemName}">
                                            <span class="material-icons transition-transform duration-200 text-white text-xl" id="endpoint-icon-${catIndex}-${endpointIndex}">expand_more</span>
                                            <span>${itemName}</span>
                                        </h3>
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs px-2 py-1 ${methodBadgeClass} font-semibold rounded-md">${method}</span>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </button>
                    
                    <div id="endpoint-${catIndex}-${endpointIndex}" class="hidden">
                        <div class="bg-[#1a1a1a] p-5 border-t border-[#2E2E2E]">
                            <!-- Tab Navigation -->
                            <div class="tab-container">
                                <button class="tab active" onclick="switchTab(${catIndex}, ${endpointIndex}, 'method')">Method</button>
                                <button class="tab" onclick="switchTab(${catIndex}, ${endpointIndex}, 'example')">Example</button>
                            </div>
                            
                            <div>
                                <!-- Tab Content: Method -->
                                <div id="method-content-${catIndex}-${endpointIndex}" class="tab-content active">
                                    <div class="mb-4"><p class="text-slate-300 font-medium text-sm">${itemDesc}</p></div>
                                    
                                    <form id="${formId}">
                                        <div class="mb-4 space-y-3" id="params-container-${catIndex}-${endpointIndex}"></div>
                                        
                                        <div class="mb-6">
                                            <label class="block text-slate-300 text-sm font-medium mb-2">Request URL</label>
                                            <div class="flex gap-2">
                                                <div class="flex-1 code-block px-4 py-3">
                                                    <code class="text-sm text-white font-mono truncate" id="url-display-${catIndex}-${endpointIndex}">${initialUrl}</code>
                                                </div>
                                                <button type="button" onclick="copyUrl(${catIndex}, ${endpointIndex})" class="bg-[#212121] border border-[#2E2E2E] hover:bg-[#262626] text-white px-4 py-3 text-sm font-medium transition-colors rounded-md">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="flex gap-3">
                                            <button type="button" onclick="executeRequest(event, ${catIndex}, ${endpointIndex}, '${method}')" 
                                                    class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium py-3 px-5 rounded-lg flex items-center justify-center gap-2 hover:opacity-90 transition-all">
                                                <i class="fas fa-play"></i> Execute Request
                                            </button>
                                            <button type="button" onclick="clearResponse(${catIndex}, ${endpointIndex})" 
                                                    class="bg-[#212121] border border-[#2E2E2E] text-white font-medium py-3 px-5 rounded-lg flex items-center justify-center gap-2 hover:bg-[#262626] transition-colors">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                        </div>
                                    </form>
                                    
                                    <div id="response-${catIndex}-${endpointIndex}" class="mt-6 hidden">
                                        <div class="flex justify-between items-center mb-3">
                                            <div class="flex items-center gap-3">
                                                <h4 class="font-bold text-white">Response</h4>
                                                <span class="content-type-badge" id="content-type-${catIndex}-${endpointIndex}"></span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-xs text-slate-400" id="response-time-${catIndex}-${endpointIndex}"></span>
                                                <button onclick="copyResponse(${catIndex}, ${endpointIndex})" class="text-slate-400 hover:text-white transition-colors"><i class="fas fa-copy"></i></button>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-[#1a1a1a] border border-[#2E2E2E] rounded-xl overflow-hidden">
                                            <div class="response-media-container p-4" id="response-content-${catIndex}-${endpointIndex}"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tab Content: Example -->
                                <div id="example-content-${catIndex}-${endpointIndex}" class="tab-content">
                                    <div class="mb-4">
                                        <p class="text-slate-300 font-medium text-sm mb-2">${itemDesc}</p>
                                        <p class="text-slate-400 text-xs">Sample code for using this endpoint in JavaScript :</p>
                                    </div>
                                    
                                    <div class="code-container">
                                        <div class="code-header">
                                            <span>JavaScript Example</span>
                                            <button onclick="copyExampleCode(${catIndex}, ${endpointIndex})">
                                                <i class="fas fa-copy mr-1"></i> Copy
                                            </button>
                                        </div>
                                        <div class="code-content">
                                            <pre><code id="example-code-${catIndex}-${endpointIndex}">// Loading example code...</code></pre>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 text-sm text-slate-400">
                                        <p class="mb-2"><i class="fas fa-info-circle mr-2"></i>This example uses the Fetch API which is available in modern browsers and Node.js (with node-fetch package)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            });
        });
        
        apiList.innerHTML = html;
        
        setTimeout(() => {
            if (categories && categories.length > 0) {
                categories.forEach((category, catIndex) => {
                    if (category && category.items) {
                        category.items.forEach((item, endpointIndex) => {
                            if (item) { 
                                initializeEndpointParameters(catIndex, endpointIndex, item);
                                generateExampleCode(catIndex, endpointIndex, item);
                            }
                        });
                    }
                });
            }
        }, 200);
    }

    function switchTab(catIndex, endpointIndex, tabName) {
        // Update active tab buttons
        const tabButtons = document.querySelectorAll(`#endpoint-${catIndex}-${endpointIndex} .tab`);
        tabButtons.forEach(btn => {
            btn.classList.remove('active');
        });
        
        event.target.classList.add('active');
        
        // Show active tab content
        const methodContent = document.getElementById(`method-content-${catIndex}-${endpointIndex}`);
        const exampleContent = document.getElementById(`example-content-${catIndex}-${endpointIndex}`);
        
        if (tabName === 'method') {
            methodContent.classList.add('active');
            exampleContent.classList.remove('active');
        } else {
            methodContent.classList.remove('active');
            exampleContent.classList.add('active');
        }
    }

    function generateExampleCode(catIndex, endpointIndex, item) {
    const method = item.method || 'GET';
    const path = item.path || '';
    const bodyParams = item.body || {};
    const hasBodyParams = method === 'POST' && Object.keys(bodyParams).length > 0;
    
    const baseUrl = window.location.origin;
    const apiPath = path.split('?')[0];
    const fullUrl = baseUrl + apiPath;
    
    const queryParams = new URLSearchParams(path.split('?')[1] || '');
    const paramNames = [];
    for (const [key] of queryParams) {
        paramNames.push(key);
    }
    
    let exampleCode = '';
    
    if (method === 'GET') {
        let queryStringExample = '';
        if (paramNames.length > 0) {
            const queryParamsObj = {};
            paramNames.forEach(param => {
                if (param === 'apikey') {
                    queryParamsObj[param] = 'apikey';
                } else if (param === 'url') {
                    queryParamsObj[param] = 'https://example.com/video';
                } else {
                    queryParamsObj[param] = `${param}`;
                }
            });
            
            queryStringExample = '?' + new URLSearchParams(queryParamsObj).toString();
        }
        
        exampleCode = `const fetch = require('node-fetch');

fetch('${fullUrl}${queryStringExample}')
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
        
    } else if (method === 'POST') {
        if (hasBodyParams) {
            const hasFileUpload = Object.values(bodyParams).some(param => 
                param === 'buffer' || param === 'file' || param === 'image' || param === 'audio' || param === 'video'
            );
            
            if (hasFileUpload) {
                exampleCode = `const FormData = require('form-data');
const fs = require('fs');
const fetch = require('node-fetch');

const formData = new FormData();`;
                
                Object.entries(bodyParams).forEach(([paramName, paramType]) => {
                    if (paramType === 'buffer' || paramType === 'file' || paramType === 'image' || paramType === 'audio' || paramType === 'video') {
                        exampleCode += `
formData.append('${paramName}', fs.createReadStream('path/to/file'));`;
                    } else {
                        const value = paramName === 'apikey' ? 'apikey' : `${paramName}`;
                        exampleCode += `
formData.append('${paramName}', '${value}');`;
                    }
                });
                
                exampleCode += `

fetch('${fullUrl}', {
    method: '${method}',
    body: formData,
    headers: formData.getHeaders()
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
                
            } else {
                const requestBody = {};
                Object.entries(bodyParams).forEach(([paramName, paramType]) => {
                    if (paramName === 'apikey') {
                        requestBody[paramName] = 'apikey';
                    } else if (paramType === 'text') {
                        requestBody[paramName] = 'text';
                    } else if (paramType === 'number') {
                        requestBody[paramName] = 123;
                    } else if (paramType === 'boolean') {
                        requestBody[paramName] = true;
                    } else {
                        requestBody[paramName] = paramName;
                    }
                });
                
                const requestBodyStr = JSON.stringify(requestBody, null, 2);
                
                exampleCode = `const fetch = require('node-fetch');

const requestBody = ${requestBodyStr};

fetch('${fullUrl}', {
    method: '${method}',
    headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    },
    body: JSON.stringify(requestBody)
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
            }
        } else {
            let queryStringExample = '';
            if (paramNames.length > 0) {
                const queryParamsObj = {};
                paramNames.forEach(param => {
                    queryParamsObj[param] = param === 'apikey' ? 'apikey' : param;
                });
                queryStringExample = '?' + new URLSearchParams(queryParamsObj).toString();
            }
            
            exampleCode = `const fetch = require('node-fetch');

fetch('${fullUrl}${queryStringExample}', {
    method: '${method}',
    headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    }
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
        }
    }
    
    const exampleCodeElement = document.getElementById(`example-code-${catIndex}-${endpointIndex}`);
    if (exampleCodeElement) {
        exampleCodeElement.textContent = exampleCode;
    }
}

    function copyExampleCode(catIndex, endpointIndex) {
        const exampleCodeElement = document.getElementById(`example-code-${catIndex}-${endpointIndex}`);
        if (!exampleCodeElement) return;
        
        const code = exampleCodeElement.textContent;
        navigator.clipboard.writeText(code).then(() => {
            showToast('Example code copied to clipboard!', 'success');
        }).catch(err => {
            showToast('Failed to copy code', 'error');
        });
    }

    function initializeEndpointParameters(catIndex, endpointIndex, item) {
        const paramsContainer = document.getElementById(`params-container-${catIndex}-${endpointIndex}`);
        const form = document.getElementById(`form-${catIndex}-${endpointIndex}`);
        if (!paramsContainer || !form) return;
        
        const method = item.method || 'GET';
        const bodyParams = item.body || {};
        const hasBodyParams = method === 'POST' && Object.keys(bodyParams).length > 0;
        
        if (method === 'GET') {
            const params = extractParameters(item.path);
            if (params.length === 0) {
                paramsContainer.innerHTML = `
                    <div class="text-center py-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-check text-white"></i>
                        </div>
                        <p class="text-slate-400 text-sm font-medium">No parameters required</p>
                    </div>
                `;
                return;
            }
            
            let paramsHtml = '';
            params.forEach((param) => {
                if (!param.name) return;
                
                const placeholder = param.name === 'apikey' 
                    ? 'Enter your API key here...' 
                    : `Enter ${param.name}...`;
                
                const inputType = param.name === 'apikey' ? 'password' : 'text';
                const paramId = `param-${catIndex}-${endpointIndex}-${param.name}`;
                
                paramsHtml += `
                <div class="param-field" data-param-name="${param.name}">
                    <label class="block text-slate-400 font-medium text-sm mb-1" for="${paramId}">
                        ${param.name}<span class="text-red-500 ml-1">* </span>
                    </label>
                    <input type="${inputType}" 
                           name="${param.name}" 
                           id="${paramId}"
                           class="w-full px-3 py-2.5 border font-medium border-[#2E2E2E] text-xs focus:outline-none focus:border-[#444444] bg-[#1a1a1a] text-white placeholder:text-gray-500 rounded-md"
                           placeholder="${placeholder}" 
                           autocomplete="off" 
                           value="${param.defaultValue || ''}" 
                           oninput="updateRequestUrl(${catIndex}, ${endpointIndex})">
                </div>`;
            });
            
            paramsContainer.innerHTML = paramsHtml;
            
            const urlDisplay = document.getElementById(`url-display-${catIndex}-${endpointIndex}`);
            if (urlDisplay) {
                const currentUrl = urlDisplay.textContent.trim();
                const baseUrl = currentUrl.split('?')[0];
                urlDisplay.dataset.baseUrl = baseUrl;
                
                setTimeout(() => {
                    updateRequestUrl(catIndex, endpointIndex);
                }, 100);
            }
            
        } else if (method === 'POST') {
                let paramsHtml = '';
                if (hasBodyParams) {
                    Object.entries(bodyParams).forEach(([paramName, paramType]) => {
                        const isFile = paramType === 'buffer' || paramType === 'file' || paramType === 'audio' || paramType === 'image' || paramType === 'video'
                        let param = paramType
                        const accept =
      param === "image" ? "image/*" :
      param === "audio" ? "audio/*" :
      param === "video" ? "video/*" :
      param === "file"  ? "*/*" :
      "";
                        if (isFile) {
                            paramsHtml += `
                            <div>
                                <label class="block text-slate-400 font-medium text-sm mb-1">${paramName}<span class="text-red-500 ml-1">* </span></label>
                                <input type="file" name="${paramName}" class="w-full px-3 py-2.5 border border-[#2E2E2E] text-xs focus:outline-none focus:border-[#444444] bg-[#1a1a1a] text-white placeholder:text-gray-500 rounded-md file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-[#2a2a2a] file:text-white hover:file:bg-[#3a3a3a]"
                                    id="param-${catIndex}-${endpointIndex}-${paramName}" onchange="handleFileSelect(${catIndex}, ${endpointIndex}, '${paramName}', this)" accept="${accept}">
                                <div id="file-info-${catIndex}-${endpointIndex}-${paramName}" class="mt-1 text-xs text-slate-500 hidden"></div>
                            </div>`;
                        } else {
                            paramsHtml += `
                            <div>
                                <label class="block text-slate-400 font-medium text-sm mb-1">${paramName}<span class="text-red-500 ml-1">* </span></label>
                                <input type="${paramName === 'apikey' ? 'password' : 'text'}" name="${paramName}" class="w-full px-3 py-2.5 border border-[#2E2E2E] text-xs focus:outline-none font-medium focus:border-[#444444] bg-[#1a1a1a] text-white placeholder:text-gray-500 rounded-md"
                                    placeholder="Enter ${paramName}..." id="param-${catIndex}-${endpointIndex}-${paramName}" autocomplete="off" value="${paramType === 'text' ? 'sample text' : ''}">
                            </div>`;
                        }
                    });
                } else {
                    const params = extractParameters(item.path);
                    if (params.length === 0) {
                        paramsHtml = `<div class="text-center py-3"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-2"><i class="fas fa-check text-white"></i></div><p class="font-medium text-slate-400 text-sm">No parameters required</p></div>`;
                    } else {
                        params.forEach((param, index) => {
                            const inputType = param.name === 'apikey' ? 'text' : 'text';
                            paramsHtml += `
                            <div>
                                <label class="block text-slate-400 text-sm font-medium mb-1">${param.name}<span class="text-red-500 ml-1">* </span></label>
                                <input type="${inputType}" name="${param.name}" class="w-full px-3 py-2.5 border border-[#2E2E2E] text-xs font-medium focus:outline-none focus:border-[#444444] bg-[#1a1a1a] text-white placeholder:text-gray-500 rounded-md"
                                    placeholder="Enter ${param.name}..." id="param-${catIndex}-${endpointIndex}-${param.name}" autocomplete="off" value="${param.defaultValue || ''}">
                            </div>`;
                        });
                    }
                }
                paramsContainer.innerHTML = paramsHtml;
            }
    }

    function extractParameters(path) {
        const params = [];
        if (!path) return params;
        const queryString = path.split('?')[1];
        if (!queryString) return params;
        try {
            const urlParams = new URLSearchParams(queryString);
            for (const [key, value] of urlParams) {
                params.push({ 
                    name: key, 
                    required: false, 
                    type: getParamType(key), 
                    description: getParamDescription(key), 
                    defaultValue: value || '' 
                });
            }
        } catch (error) {}
        return params;
    }

    function getParamType(paramName) {
        const types = { 
            'apikey': 'string', 'url': 'string', 'question': 'string', 'query': 'string', 
            'prompt': 'string', 'format': 'string', 'quality': 'string', 'size': 'string', 
            'limit': 'number', 'text': 'string', 'amount': 'number', 'from': 'string', 
            'to': 'string', 'username': 'string', 'count': 'number', 'page': 'number', 
            'id': 'string', 'token': 'string' 
        };
        return types[paramName] || 'string';
    }

    function getParamDescription(paramName) {
        const descriptions = { 
            'apikey': 'Your API key for authentication', 
            'url': 'URL of the content to download/process', 
            'question': 'Question or message to ask the AI', 
            'query': 'Search query or keywords', 
            'prompt': 'Text description for image generation', 
            'format': 'Output format (mp4, mp3, jpg, png)', 
            'quality': 'Video quality (360p, 720p, 1080p)', 
            'size': 'Image dimensions (512x512, 1024x1024)', 
            'limit': 'Number of results to return', 
            'text': 'Text content to process', 
            'amount': 'Amount to convert', 
            'from': 'Source currency code', 
            'to': 'Target currency code', 
            'username': 'Username to lookup', 
            'count': 'Number of items to return', 
            'page': 'Page number for pagination', 
            'id': 'Unique identifier', 
            'token': 'Access token' 
        };
        return descriptions[paramName] || 'Optional parameter';
    }

    function setupEventListeners() {
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        
        if (searchInput) { 
            searchInput.addEventListener('input', function() { handleSearch(this.value); }); 
        }
        if (clearSearchBtn) { 
            clearSearchBtn.addEventListener('click', function() { 
                document.getElementById('searchInput').value = ''; 
                handleSearch(''); 
                showToast('Search cleared', 'info'); 
            }); 
        }
    }

    function handleSearch(searchTerm) {
        const searchTermLower = (searchTerm || '').toLowerCase().trim();
        const noResults = document.getElementById('noResults');
        if (!searchTermLower) {
            if (activeCategoryFilter === 'all') { 
                renderAPIData(originalCategories); 
            } else { 
                const filteredCategories = originalCategories.filter(category => category.name.toLowerCase() === activeCategoryFilter); 
                renderAPIData(filteredCategories); 
            }
            if (noResults) noResults.classList.add('hidden');
            updateSearchResultsCount();
            return;
        }
        
        let filteredData = [];
        if (activeCategoryFilter === 'all') {
            filteredData = searchAcrossAllCategories(searchTermLower);
        } else {
            const activeCategory = originalCategories.find(cat => cat.name.toLowerCase() === activeCategoryFilter);
            if (activeCategory) {
                const filteredItems = activeCategory.items.filter(item => {
                    if (!item) return false;
                    return (
                        (item.name || '').toLowerCase().includes(searchTermLower) || 
                        (item.desc || '').toLowerCase().includes(searchTermLower) || 
                        (item.path || '').toLowerCase().includes(searchTermLower) || 
                        (item.method || '').toLowerCase().includes(searchTermLower)
                    );
                });
                if (filteredItems.length > 0) { 
                    filteredData.push({ ...activeCategory, items: filteredItems }); 
                }
            }
        }
        
        if (filteredData.length === 0) {
            const apiList = document.getElementById('apiList');
            if (apiList) apiList.innerHTML = '';
            if (noResults) { 
                noResults.classList.remove('hidden'); 
            }
        } else {
            renderAPIData(filteredData);
            if (noResults) noResults.classList.add('hidden');
        }
        updateSearchResultsCount(searchTermLower, filteredData);
    }

    function searchAcrossAllCategories(searchTerm) {
        const filteredData = [];
        originalCategories.forEach(category => {
            if (!category || !category.items) return;
            const filteredItems = category.items.filter(item => {
                if (!item) return false;
                return (
                    (item.name || '').toLowerCase().includes(searchTerm) || 
                    (item.desc || '').toLowerCase().includes(searchTerm) || 
                    (item.path || '').toLowerCase().includes(searchTerm) || 
                    (item.method || '').toLowerCase().includes(searchTerm) || 
                    (category.name || '').toLowerCase().includes(searchTerm)
                );
            });
            if (filteredItems.length > 0) { 
                filteredData.push({ ...category, items: filteredItems }); 
            }
        });
        return filteredData;
    }

    function updateSearchResultsCount(searchTerm = '', filteredData = null) {
        const searchResultsCount = document.getElementById('searchResultsCount');
        const resultsCount = document.getElementById('resultsCount');
        if (!searchResultsCount || !resultsCount) return;
        if (!searchTerm) { 
            searchResultsCount.classList.add('hidden'); 
            return; 
        }
        let totalItems = 0;
        if (filteredData) { 
            filteredData.forEach(category => { 
                totalItems += (category.items || []).length; 
            }); 
        }
        resultsCount.textContent = totalItems;
        searchResultsCount.classList.remove('hidden');
    }

    function toggleEndpoint(catIndex, endpointIndex) {
        const endpoint = document.getElementById(`endpoint-${catIndex}-${endpointIndex}`);
        const icon = document.getElementById(`endpoint-icon-${catIndex}-${endpointIndex}`);
        if (endpoint && icon) {
            if (endpoint.classList.contains('hidden')) {
                endpoint.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
                setTimeout(() => { 
                    endpoint.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); 
                }, 100);
            } else {
                endpoint.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }
    }

    function updateRequestUrl(catIndex, endpointIndex) {
        const form = document.getElementById(`form-${catIndex}-${endpointIndex}`);
        const urlDisplay = document.getElementById(`url-display-${catIndex}-${endpointIndex}`);
        
        if (!form || !urlDisplay) return { url: '', hasErrors: false };
        
        let baseUrl = urlDisplay.dataset.baseUrl;
        if (!baseUrl) {
            const currentUrl = urlDisplay.textContent.trim();
            const questionMarkIndex = currentUrl.indexOf('?');
            baseUrl = questionMarkIndex !== -1 ? currentUrl.substring(0, questionMarkIndex) : currentUrl;
            urlDisplay.dataset.baseUrl = baseUrl;
        }
        
        const inputs = form.querySelectorAll('input[type="text"], input[type="password"]');
        
        const params = new URLSearchParams();
        
        inputs.forEach(input => {
            const name = input.name;
            const value = input.value.trim();
            if (name && value) {
                params.append(name, value);
            }
        });
        
        const queryString = params.toString();
        const finalUrl = baseUrl + (queryString ? '?' + queryString : '');
        urlDisplay.textContent = finalUrl;
        
        console.log('Updated URL for GET:', {
            baseUrl: baseUrl,
            params: Object.fromEntries(params),
            finalUrl: finalUrl
        });
        
        return { url: finalUrl, hasErrors: false };
    }

    function validateApiKey(catIndex, endpointIndex) {
        const form = document.getElementById(`form-${catIndex}-${endpointIndex}`);
        if (!form) return true;
        
        const apikeyInput = form.querySelector('input[name="apikey"]');
        if (apikeyInput) {
            const apikeyValue = apikeyInput.value.trim();
            if (!apikeyValue) {
                showToast('API key is required for this endpoint', 'error');
                apikeyInput.focus();
                return false;
            }
            
            if (apikeyValue.length < 1) {
                showToast('API key appears to be too short', 'warning');
            }
        }
        
        return true;
    }

    async function executeRequest(event, catIndex, endpointIndex, method) {
        event.preventDefault();
        
        if (!validateApiKey(catIndex, endpointIndex)) {
            return;
        }
        
        let requestUrl;
        
        const responseDiv = document.getElementById(`response-${catIndex}-${endpointIndex}`);
        const responseContent = document.getElementById(`response-content-${catIndex}-${endpointIndex}`);
        const responseTime = document.getElementById(`response-time-${catIndex}-${endpointIndex}`);
        const contentTypeBadge = document.getElementById(`content-type-${catIndex}-${endpointIndex}`);
        
        if (!responseDiv || !responseContent || !responseTime || !contentTypeBadge) {
            showToast('Error: Response elements not found', 'error');
            return;
        }
        
        responseDiv.classList.remove('hidden');
        responseDiv.style.display = 'block';
        
        responseContent.innerHTML = `
            <div class="flex flex-col items-center justify-center py-12">
                <div class="loader mb-6"></div>
                <p class="text-slate-400">Sending request to API...</p>
            </div>
        `;
        
        responseTime.textContent = '';
        contentTypeBadge.textContent = '';
        
        const startTime = Date.now();
        
        try {
            let requestOptions = {
                method: method,
                headers: { 
                    'Accept': '*/*', 
                    'User-Agent': 'Skyzopedia-API-Docs/1.0'
                }
            };
            
            if (method === 'POST') {
                const form = document.getElementById(`form-${catIndex}-${endpointIndex}`);
                const formData = new FormData();
                
                const textInputs = form.querySelectorAll('input[type="text"], input[type="password"]');
                const fileInputs = form.querySelectorAll('input[type="file"]');
                
                textInputs.forEach(input => {
                    if (input.value.trim()) {
                        formData.append(input.name, input.value.trim());
                    }
                });
                
                fileInputs.forEach(input => {
                    if (input.files.length > 0) {
                        formData.append(input.name, input.files[0]);
                    }
                });
                
                requestOptions.body = formData;
                requestUrl = document.getElementById(`url-display-${catIndex}-${endpointIndex}`).textContent.trim().split('?')[0];
                
                console.log('POST Request:', requestUrl);
                console.log('Form Data:');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }
                
            } else {
                const result = updateRequestUrl(catIndex, endpointIndex);
                requestUrl = result.url;
                
                console.log('GET Request URL:', requestUrl);
                
                const urlObj = new URL(requestUrl);
                const params = urlObj.searchParams;
                console.log('URL Parameters:');
                for (let [key, value] of params.entries()) {
                    console.log(`  ${key}: "${value}" (length: ${value.length})`);
                }
            }
            
            console.log('Full Request Options:', requestOptions);
            
            const response = await fetch(requestUrl, requestOptions);
            const responseTimeMs = Date.now() - startTime;
            responseTime.textContent = `${responseTimeMs}ms`;
            
            const contentType = response.headers.get('content-type') || '';
            contentTypeBadge.textContent = contentType.split(';')[0] || 'unknown';
            
            if (!response.ok) {
                let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                try {
                    const errorData = await response.text();
                    if (errorData) {
                        try { 
                            const jsonError = JSON.parse(errorData); 
                            errorMessage = jsonError.error || jsonError.message || errorMessage; 
                        } catch { 
                            if (errorData.length > 0) { 
                                errorMessage += ` - ${errorData.substring(0, 100)}`; 
                            } 
                        }
                    }
                } catch (e) {}
                throw new Error(errorMessage);
            }
            
            if (contentType.includes('application/json')) {
                const data = await response.json();
                responseContent.innerHTML = `<pre class="text-sm p-4 font-mono text-slate-300 overflow-auto max-h-96 bg-[#1a1a1a] rounded-lg">${JSON.stringify(data, null, 2)}</pre>`;
            } else if (contentType.includes('text/')) {
                const text = await response.text();
                if (text.trim().startsWith('{') || text.trim().startsWith('[')) {
                    try { 
                        const jsonData = JSON.parse(text); 
                        responseContent.innerHTML = `<pre class="text-sm p-4 font-mono text-slate-300 overflow-auto max-h-96 bg-[#1a1a1a] rounded-lg">${JSON.stringify(jsonData, null, 2)}</pre>`; 
                    } catch { 
                        responseContent.innerHTML = `<pre class="text-sm p-4 font-mono text-slate-300 overflow-auto max-h-96 whitespace-pre-wrap break-words bg-[#1a1a1a] rounded-lg">${text}</pre>`; 
                    }
                } else { 
                    responseContent.innerHTML = `<pre class="text-sm p-4 font-mono text-slate-300 overflow-auto max-h-96 whitespace-pre-wrap break-words bg-[#1a1a1a] rounded-lg">${text}</pre>`; 
                }
            } else if (contentType.includes('image/')) {
                const blob = await response.blob();
                const imageUrl = URL.createObjectURL(blob);
                responseContent.innerHTML = `
                    <div class="p-4 flex flex-col items-center justify-center">
                        <img src="${imageUrl}" alt="Image Response" class="max-w-full max-h-96 object-contain rounded-lg shadow-lg mb-4" />
                        <div class="flex items-center gap-4 text-sm text-slate-400 flex-wrap justify-center">
                            <span><i class="fas fa-file-image mr-1"></i> ${contentType.split(';')[0]}</span>
                            <span><i class="fas fa-weight-hanging mr-1"></i> ${formatBytes(blob.size)}</span>
                            <a href="${imageUrl}" download="image" class="text-blue-400 hover:text-blue-300"><i class="fas fa-download mr-1"></i> Download</a>
                        </div>
                    </div>
                `;
            } else if (contentType.includes('audio/')) {
                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                responseContent.innerHTML = `
                    <div class="p-6 flex flex-col items-center justify-center">
                        <div class="w-full max-w-md mb-4"><audio controls class="w-full"><source src="${audioUrl}" type="${contentType}"></audio></div>
                        <div class="flex items-center gap-4 text-sm text-slate-400 flex-wrap justify-center">
                            <span><i class="fas fa-file-audio mr-1"></i> ${contentType.split(';')[0]}</span>
                            <span><i class="fas fa-weight-hanging mr-1"></i> ${formatBytes(blob.size)}</span>
                            <a href="${audioUrl}" download="audio" class="text-blue-400 hover:text-blue-300"><i class="fas fa-download mr-1"></i> Download</a>
                        </div>
                    </div>
                `;
            } else if (contentType.includes('video/')) {
                const blob = await response.blob();
                const videoUrl = URL.createObjectURL(blob);
                responseContent.innerHTML = `
                    <div class="p-4 flex flex-col items-center justify-center">
                        <div class="w-full max-w-xl mb-4">
                            <video controls class="w-full max-h-96 object-contain rounded-lg shadow-lg"><source src="${videoUrl}" type="${contentType}"></video>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-slate-400 flex-wrap justify-center">
                            <span><i class="fas fa-file-video mr-1"></i> ${contentType.split(';')[0]}</span>
                            <span><i class="fas fa-weight-hanging mr-1"></i> ${formatBytes(blob.size)}</span>
                            <a href="${videoUrl}" download="video" class="text-blue-400 hover:text-blue-300"><i class="fas fa-download mr-1"></i> Download</a>
                        </div>
                    </div>
                `;
            } else {
                try {
                    const text = await response.text();
                    responseContent.innerHTML = `<pre class="text-sm p-4 font-mono text-slate-300 overflow-auto max-h-96 whitespace-pre-wrap break-words bg-[#1a1a1a] rounded-lg">${text}</pre>`;
                    contentTypeBadge.textContent = 'text/plain (auto-detected)';
                } catch (error) { 
                    throw new Error(`Unsupported content type: ${contentType}`); 
                }
            }
            showToast('API request successful!', 'success');
        } catch (error) {
            console.error('API Request Error:', error);
            const errorMessage = error.message || 'Unknown error occurred';
            responseContent.innerHTML = `
                <div class="text-center py-10 px-4">
                    <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-red-400 text-2xl"></i>
                    </div>
                    <h4 class="font-bold text-white mb-2">API Request Failed</h4>
                    <p class="text-slate-400 text-sm">${escapeHtml(errorMessage)}</p>
                    <p class="text-slate-500 text-xs mt-2 truncate max-w-full">URL: ${method} ${requestUrl}</p>
                    <div class="mt-6">
                        <p class="text-xs text-slate-500 mb-1">Troubleshooting steps:</p>
                        <ul class="text-xs text-slate-500 text-left list-disc list-inside space-y-1">
                            <li>Check if the API endpoint is accessible</li>
                            <li>Verify the required parameters are filled</li>
                            <li>Check browser console for detailed errors</li>
                            <li>Make sure CORS is enabled on the server</li>
                            <li>For POST: Check if you're sending the correct data format</li>
                        </ul>
                    </div>
                </div>
            `;
            responseTime.textContent = 'Error';
            contentTypeBadge.textContent = 'error';
            showToast(`API request failed: ${errorMessage.substring(0, 50)}...`, 'error');
        }
    }

    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    function clearResponse(catIndex, endpointIndex) {
        const form = document.getElementById(`form-${catIndex}-${endpointIndex}`);
        const responseDiv = document.getElementById(`response-${catIndex}-${endpointIndex}`);
        const apiItem = document.querySelector(`#endpoint-${catIndex}-${endpointIndex}`).closest('.api-item');
        
        if (!form || !responseDiv || !apiItem) return;
        
        const method = apiItem.dataset.method || 'GET';
        
        const textInputs = form.querySelectorAll('input[type="text"], input[type="password"]');
        const fileInputs = form.querySelectorAll('input[type="file"]');
        
        textInputs.forEach(input => { 
            input.value = ''; 
        });
        
        fileInputs.forEach(input => {
            input.value = '';
            const paramName = input.name;
            const fileInfoDiv = document.getElementById(`file-info-${catIndex}-${endpointIndex}-${paramName}`);
            if (fileInfoDiv) { 
                fileInfoDiv.classList.add('hidden'); 
                fileInfoDiv.innerHTML = ''; 
            }
        });
        
        responseDiv.classList.add('hidden');
        
        if (method === 'GET') { 
            updateRequestUrl(catIndex, endpointIndex); 
        }
        
        showToast('Form cleared', 'info');
    }

    function copyUrl(catIndex, endpointIndex) {
        const urlDisplay = document.getElementById(`url-display-${catIndex}-${endpointIndex}`);
        if (!urlDisplay) return;
        const url = urlDisplay.textContent.trim();
        navigator.clipboard.writeText(url).then(() => { 
            showToast('URL copied to clipboard!', 'success'); 
        }).catch(err => { 
            showToast('Failed to copy URL', 'error'); 
        });
    }

    function copyResponse(catIndex, endpointIndex) {
        const responseContent = document.getElementById(`response-content-${catIndex}-${endpointIndex}`);
        if (!responseContent) return;
        const text = responseContent.textContent || responseContent.innerText;
        navigator.clipboard.writeText(text).then(() => { 
            showToast('Response copied to clipboard!', 'success'); 
        }).catch(err => { 
            showToast('Failed to copy response', 'error'); 
        });
    }

    function showToast(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) return;
        const toastId = 'toast-' + Date.now();
        const icon = { 
            'success': 'fas fa-check-circle', 
            'error': 'fas fa-exclamation-circle', 
            'info': 'fas fa-info-circle', 
            'warning': 'fas fa-exclamation-triangle' 
        }[type] || 'fas fa-info-circle';
        const colorClass = { 
            'success': 'text-green-400', 
            'error': 'text-red-400', 
            'info': 'text-blue-400', 
            'warning': 'text-yellow-400' 
        }[type] || 'text-blue-400';
        const toast = document.createElement('div');
        toast.id = toastId;
        toast.className = 'toast';
        toast.innerHTML = `
            <div class="flex items-center gap-3">
                <i class="${icon} ${colorClass} text-lg"></i>
                <div>
                    <p class="text-white font-medium">${message}</p>
                </div>
            </div>
        `;
        toastContainer.appendChild(toast);
        setTimeout(() => { toast.classList.add('show'); }, 10);
        setTimeout(() => { 
            toast.classList.remove('show'); 
            setTimeout(() => { 
                if (toast.parentNode) { 
                    toast.parentNode.removeChild(toast); 
                } 
            }, 500); 
        }, 4000);
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function showErrorMessage(err = undefined) {
        const loadingScreen = document.getElementById('loadingScreen');
        if (!loadingScreen) return;
        loadingScreen.innerHTML = `
            <div class="text-center p-8">
                <div class="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-exclamation-triangle text-red-400 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-4">Connection Error</h2>
                <p class="text-slate-300 mb-6">${err ? err : "Unable to load API documentation. Please check your connection."}</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="location.reload()" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium py-3 px-6 rounded-lg">
                        <i class="fas fa-redo mr-2"></i> Try Again
                    </button>
                    <button onclick="loadOfflineMode()" class="bg-[#212121] border border-[#2E2E2E] text-white font-medium py-3 px-6 rounded-lg">
                        <i class="fas fa-wifi-slash mr-2"></i> Offline Mode
                    </button>
                </div>
            </div>
        `;
        settings = getDefaultSettings();
        setupUI();
        setTimeout(() => { loadingScreen.style.opacity = '0.9'; }, 500);
    }

    function loadOfflineMode() {
        const loadingScreen = document.getElementById('loadingScreen');
        if (!loadingScreen) return;
        loadingScreen.innerHTML = `
            <div class="text-center p-8">
                <div class="w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-wifi-slash text-yellow-400 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-4">Offline Mode</h2>
                <p class="text-slate-300 mb-6">Using offline documentation. API testing will not work.</p>
                <p class="text-slate-400 text-sm mb-6">Reconnect to the internet to access live API endpoints.</p>
                <button onclick="location.reload()" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium py-3 px-6 rounded-lg">
                    <i class="fas fa-redo mr-2"></i> Try Again
                </button>
            </div>
        `;
        setTimeout(() => {
            loadingScreen.style.opacity = '0';
            setTimeout(() => { loadingScreen.style.display = 'none'; }, 500);
        }, 2000);
    }

    function handleFileSelect(catIndex, endpointIndex, paramName, fileInput) {
        const fileInfoDiv = document.getElementById(`file-info-${catIndex}-${endpointIndex}-${paramName}`);
        if (!fileInput.files.length) return;
        const file = fileInput.files[0];
        const fileSize = formatFileSize(file.size);
        fileInfoDiv.innerHTML = `
            <div class="flex items-center gap-2 text-green-400 font-medium">
                <i class="fas fa-check-circle"></i>
                <span class="font-medium">${file.name} (${fileSize})</span>
            </div>
        `;
        fileInfoDiv.classList.remove('hidden');
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    window.toggleEndpoint = toggleEndpoint;
    window.executeRequest = executeRequest;
    window.clearResponse = clearResponse;
    window.copyUrl = copyUrl;
    window.copyResponse = copyResponse;
    window.updateRequestUrl = updateRequestUrl;
    window.loadOfflineMode = loadOfflineMode;
    window.handleFileSelect = handleFileSelect;
    window.formatFileSize = formatFileSize;
    window.switchTab = switchTab;
    window.copyExampleCode = copyExampleCode;
</script>
</body>
</html>